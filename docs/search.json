[
  {
    "objectID": "setting_cran_mirror.html",
    "href": "setting_cran_mirror.html",
    "title": "CRAN mirror の設定",
    "section": "",
    "text": "昨年から参加しているオンラインスクール mJOHNSNOW の R に関する Slack チャットで CRAN mirror の設定に起因するトラブルをよく見るので、設定方法を確認します。"
  },
  {
    "objectID": "setting_cran_mirror.html#要旨",
    "href": "setting_cran_mirror.html#要旨",
    "title": "CRAN mirror の設定",
    "section": "要旨",
    "text": "要旨\n\n以前よく使われていた統計数理研究所 cran.ism.ac.jp は運用終了となり使用できません。\nR の各種パッケージを入手するための CRAN (The Comprehensive R Archive Network) ミラーサイトは、特別な事情がなければ次のどちらかで問題ありません。\n\nhttps://cloud.r-project.org （標準）\nhttps://cran.rstudio.com\n\n継続的に CRAN ミラーサイトの設定を変更するには、RStudio の設定画面または .Rprofile ファイルでの設定が必要です。"
  },
  {
    "objectID": "setting_cran_mirror.html#問題の概要",
    "href": "setting_cran_mirror.html#問題の概要",
    "title": "CRAN mirror の設定",
    "section": "問題の概要",
    "text": "問題の概要\nmJOHNSNOW はパブリックヘルスがテーマのオンラインスクールで、R を使った講義も多く行われています。Slack のチャットでよく見かけるトラブルで、\n警告: failed to find binary for 'MASS 7.3-60.2' in package repositories\n警告: failed to find source for 'MASS 7.3-60.2' in package repositories\n警告: error downloading 'https://cran.ism.ac.jp//src/contrib/Archive/MASS/MASS_7.3-60.2.tar.gz' [error code 22]\n警告: error downloading 'https://cran.ism.ac.jp//src/contrib/Archive/MASS/MASS_7.3-60.2.tar.gz' [error code 22]\nエラー: failed to retrieve package 'MASS@7.3-60.2'\nなどのメッセージが出てパッケージのインストールができない、というものがあります。\nR では、本体に加えてパッケージという形にまとめられた各種の処理（関数）やデータが CRAN (The Comprehensive R Archive Network) というサイトを通じて配布されています。本家 cran.r-project.org へのアクセス集中による負荷を減らすため、各国に本家のコピー（ミラーサイト）が設置・運営されてきました。\nこの問題は、統計数理研究所で長らく運営されてきて、少し古い資料でミラーサイトの設定によく勧められていた cran.ism.ac.jp というサーバーが 2024年6月で運用終了となって既に存在していない ことによります。"
  },
  {
    "objectID": "setting_cran_mirror.html#対策",
    "href": "setting_cran_mirror.html#対策",
    "title": "CRAN mirror の設定",
    "section": "対策",
    "text": "対策\n\nCDNを用いたクラウドベースのミラーサーバー\n2017年頃から、CDN (Contents Delivery Network) の仕組みで高速にアクセスできるクラウドベースのミラーサーバーが登場し、そちらを使用することが勧められています。\n\nR projct 標準の cloud.r-project.org\nPosit（旧 RStudio）社が運営する cran.rstudio.com\n\nの2つが現在利用できます。\n\n\nスナップショット\n現在進行中のプロジェクトの都合などで、R 本体や解析用パッケージのバージョンを更新したくない場面もあります。そのような場合には、特定の時点の CRAN の内容を保持している「スナップショット」サービスが有効です。\nPosit Package Manager を使った設定については稿を改めます。"
  },
  {
    "objectID": "setting_cran_mirror.html#実際の使い方",
    "href": "setting_cran_mirror.html#実際の使い方",
    "title": "CRAN mirror の設定",
    "section": "実際の使い方",
    "text": "実際の使い方\n\n一時的にインストール元を指定する場合\ninstall.packages() のオプション repos = に直接インストール元を指定することができます。\n\ninstall.packages(\"MASS\", repos = \"cloud.r-project.org\")\n\n\n\n継続的にインストール元を変更する場合\nRStudio では、Tools - Global Options… - Packages - Primary CRAN Repository で設定を変更することができます。 ただし、この設定は RStudio 上でのみ反映されます。\n\n\n\nRStudio setting\n\n\nRStudio 以外でも有効にするためには、.Rprofile というファイルに以下のような記載をします。\n.Rprofile の場所は R のコンソールで Sys.getenv(\"R_USER\") を実行して表示されたフォルダ（ディレクトリ）です。最近の Windows では、“C:/Users/*****/OneDrive/ドキュメント” のような OneDrive 上にあるかもしれません。ファイルがなければ、新しく作る必要があります。\n\noptions(repos = c(CRAN = \"https://cloud.r-project.org\"))"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "memoRandum",
    "section": "",
    "text": "旧版の R にパッケージをインストールする\n\n\n\nR\n\n設定\n\nmJOHNSNOW\n\n\n\n\n\n\n\n2025年7月1日\n\n\n\n\n\n\n\n\n\n\nCRAN mirror の設定\n\n\n\nR\n\n設定\n\nmJOHNSNOW\n\n\n\n\n\n\n\n2025年6月30日\n\n\n\n\n\n\n一致なし"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About this site",
    "section": "",
    "text": "R を中心とする個人的なメモです。\nZenn の原稿その他をストックしています。"
  },
  {
    "objectID": "install_old_packages.html",
    "href": "install_old_packages.html",
    "title": "旧版の R にパッケージをインストールする",
    "section": "",
    "text": "パッケージを追加しようとしたとき、新しいバージョンの R を求められることがあります。R 本体の更新ができないとき、パッケージの最新版でなくともよい場合の回避策のメモです。"
  },
  {
    "objectID": "install_old_packages.html#要旨",
    "href": "install_old_packages.html#要旨",
    "title": "旧版の R にパッケージをインストールする",
    "section": "要旨",
    "text": "要旨\nR のパッケージを追加しようとしたとき、新しいバージョンの R が必要になった場合の回避策として、\n\nCRAN のアーカイブから .zip, .tar.gz 等のファイルをダウンロードまたは直接指定してインストール\nremotes::install_version() や pak::pkg_install() のようなバージョンを指定できるパッケージ導入方法を使う\n使用中の R 本体に合わせて、インストール元を過去の CRAN スナップショット（Posit Package Manager）にする\n\n個人的なおすすめは、パッケージのバージョン指定も Posit Package Manager からのインストールも対応できる pak パッケージです。"
  },
  {
    "objectID": "install_old_packages.html#問題の概要",
    "href": "install_old_packages.html#問題の概要",
    "title": "旧版の R にパッケージをインストールする",
    "section": "問題の概要",
    "text": "問題の概要\n生存期間分析、生存曲線の作図など医療統計でよく用いられる R のパッケージに survminer があります。\nmJOHNSNOW の R 解析セミナーで survminer 導入時にうまくいかない事例が多発し、検証の結果、動作に必要なパッケージのひとつ Matrix が R 4.4 以降を要求するようになったため、R 4.3系以前の環境の方がインストールできなくなっていることが判明しました。\n 警告メッセージ:\npackage ‘Matrix’ is not available for this version of R\n‘Matrix’ version 1.7-3 is in the repositories but depends on R (&gt;= 4.4)\n‘Matrix’ version 1.7-3 is in the repositories but depends on R (&gt;= 4.6)\n\nA version of this package for your version of R might be available elsewhere,\nsee the ideas at\nhttps://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Installing-packages\n他にも特定の R バージョンを要求するものがありましたが、ここでは Matrix を例に進めます。\nまず、pak::pkg_history() を使って Matrix のこれまでのリリース情報から要求される R のバージョンを見てみます。\n\n# pacman がなければインストール\nif (!(\"pacman\" %in% .packages(all.available = TRUE))) {\n  install.packages(\"pacman\")\n}\n# パッケージの読み込み（なければインストール後に読み込む）\npacman::p_load(tidyverse)\npacman::p_load(pak)\n\npkg_history(pkg = \"Matrix\") %&gt;% \n  rownames_to_column() %&gt;%\n  select(Package, Version, Date, dependencies) %&gt;%\n  # dependencies に含まれる \"R\" の要求バージョンを取り出す\n  mutate(\n    `R dependency` = map_chr(dependencies,\n                             \\(x) filter(x, package == \"R\") %&gt;% pull(version))\n  ) %&gt;% \n  select(-dependencies) %&gt;% \n  arrange(desc(Date)) %&gt;% \n  head(10) \n\n\n\n\n\nPackage\nVersion\nDate\nR dependency\n\n\n\n\nMatrix\n1.7-3\n2025-03-05\n&gt;= 4.4\n\n\nMatrix\n1.7-2\n2025-01-20\n&gt;= 4.4\n\n\nMatrix\n1.7-1\n2024-10-17\n&gt;= 4.4.0\n\n\nMatrix\n1.7-0\n2024-03-16\n&gt;= 4.4.0\n\n\nMatrix\n1.6-5\n2024-01-06\n&gt;= 3.5.0\n\n\nMatrix\n1.6-4\n2023-11-29\n&gt;= 3.5.0\n\n\nMatrix\n1.6-3\n2023-11-13\n&gt;= 3.5.0\n\n\nMatrix\n1.6-2\n2023-11-03\n&gt;= 3.5.0\n\n\nMatrix\n1.6-1.1\n2023-09-08\n&gt;= 3.5.0\n\n\nMatrix\n1.6-1\n2023-08-11\n&gt;= 3.5.0\n\n\n\n\n\n\nバージョン 1.6-5 （2024-01-06 公開）ならば、R 4.3系でも使用できそうです。"
  },
  {
    "objectID": "install_old_packages.html#対策",
    "href": "install_old_packages.html#対策",
    "title": "旧版の R にパッケージをインストールする",
    "section": "対策",
    "text": "対策\n\nCRAN のアーカイブからインストール\nCRAN (The Comprehensive R Archive Network) からは過去のバージョンのパッケージも .zip 形式や .tar.gz (.tgz) 形式で入手することができます。OS、R のバージョン別になっているので適切なものを探す必要があるほか、関連（依存）パッケージがある場合はうまくいかない可能性があります。\n例えば、R 4.3向けのパッケージでは\n\nWindows : cloud.r-project.org/bin/windows/contrib/4.3/\nmacOS Big Sur 以降, Apple Silicon : cloud.r-project.org/bin/macosx/big-sur-arm64/contrib/4.3/\nmacOS Big Sur 以降, Intel CPU : cloud.r-project.org/bin/macosx/big-sur-x86_64/contrib/4.3/\n\n上記より、Matrix_1.6-5.zip (Windows) または Matrix_1.6-5.tgz (macOS) を working directory にダウンロードして\n\ninstall.packages(\"Matrix_1.6-5.zip\", repos = NULL)\n\nとするか、上記アーカイブのアドレスを使って\n\ninstall.packages(\"https://cloud.r-project.org/bin/windows/contrib/4.3/Matrix_1.6-5.zip\", repos = NULL)\n\nとすることでインストールが可能です。repos = NULL は省略しても補完されますが、明示的に指定したほうが確実です。\n\n\nパッケージのバージョンを指定してインストール\n上記のアーカイブには、対象の R のバージョンにより存在しないパッケージのバージョンもあります。remotes::install_version() のようにバージョンを指定してインストールできる命令を使用すると、もう少し柔軟なインストールが可能です。\n\n# repos は最新の CRAN を指定するほうが良い\nremotes::install_version(package = \"Matrix\", version = \"1.6-5\", repos = \"cloud.r-project.org\")\n\n\n\nPosit Package Manager のスナップショットからインストール\nPosit（旧 RStudio）社が運営する、日々の CRAN ライブラリーの内容が保管されているサイトです。 かつて Microsoft が運営していた同様のサイト MRAN （The Microsoft R Application Network) はソースコードの配布のみでしたが、Posit Package Manager は主要な OS (Windows, macOS, Linux) のバイナリパッケージが配布されているため、インストールも高速です。\n\n\n\nPPM setting 1\n\n\nまず、packagemanager.posit.co/client にアクセスして [SETUP] へ進みます。\n\n\n\nPPM setting 2\n\n\n\nOperating System は今回は Windows を選択\nSnapshots は “Yes, always install packages from the date I choose”\nカレンダー画面から、上記リストで Matrix 1.6-5 の次のバージョンがリリースされた前日（2024-03-15）を選択\nEnvironment は “RStudio IDE” を選択（次の Repository URL には影響なし）\nRepository URL の右側の [Copy] をクリック、または表示されている URL をコピー\n\nこの URL を install.packages() の repos = に指定することで、関連パッケージを含めて Matrix 1.6-5 が最新バージョンであった 2024-03-15 時点のバージョンに揃えてインストールできるようになります。\n\ninstall.packages(\"Matrix\", repos = \"https://packagemanager.posit.co/cran/2024-03-15\")"
  },
  {
    "objectID": "install_old_packages.html#pak-パッケージの活用",
    "href": "install_old_packages.html#pak-パッケージの活用",
    "title": "旧版の R にパッケージをインストールする",
    "section": "pak パッケージの活用",
    "text": "pak パッケージの活用\npak は CRAN だけでなく、GitHub や BioConductor といった別のサイトで配布されているパッケージや、ダウンロードしたファイルからも同じ命令でパッケージのインストールができる多機能なパッケージです。\n基本的な使い方は\n\n# package_name をインストールする（どちらを使っても良い）\npak::pak(\"package_name\")\npak::pkg_install(\"package_name\")\n\nで、package_name の部分の書き方により CRAN 以外のサイトや最新版以外のバージョンをインストールすることも可能です。\n\n# GitHub にある dplyr の最新開発版をインストールする\npak::pak(\"tidyverse/dplyr\")\n\n# `Matrix 1.6-5` をインストールする\npak::pak(\"Matrix@1.6-5\")\n\n# ダウンロードしたファイルからインストール\npak::pak(\"local::Matrix_1.6-5.zip\")\n\nインストール元（レポジトリ）を検索、設定することもできます。\n\n# R 4.4.0 がリリースされた翌日の Posit Package Manager\n# 実行中の OS に応じた URL が返される\npak::repo_resolve(\"PPM@R-4.4.0\")\n##                                              CRAN \n## \"https://packagemanager.posit.co/cran/2024-04-25\"\n\n# survminer 0.5.0 がリリースされた翌日の Posit Package Manager\n# Matrix は 1.x-y 形式でハイフンが入るためうまくいかない\npak::repo_resolve(\"PPM@survminer-0.5.0\")\n##                                              CRAN \n## \"https://packagemanager.posit.co/cran/2024-10-31\"\n\n# 特定の日付の Posit Package Manager\npak::repo_resolve(\"PPM@2024-03-15\")\n##                                              CRAN \n## \"https://packagemanager.posit.co/cran/2024-03-15\"\n\n\n# インストール元を Posit Package Manager で指定\ninstall.packages(\"Matrix\", repos = pak::repo_resolve(\"PPM@R-4.4.0\"))\n\n# 継続的に変更する場合（R を終了するまで有効）\npak::repo_add(CRAN = pak::repo_resolve(\"PPM@R-4.4.0\"))\npak::repo_get()\n\n## # A data frame: 7 × 5\n##   name          url                                                    type     r_version bioc_version\n## * &lt;chr&gt;         &lt;chr&gt;                                                  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;       \n## 1 P3M           https://packagemanager.posit.co/cran/latest            cranlike *         NA          \n## 2 CRAN          https://packagemanager.posit.co/cran/2024-04-25        cran     *         NA          \n## 3 BioCsoft      https://bioconductor.org/packages/3.20/bioc            bioc     4.4.3     3.20        \n## 4 BioCann       https://bioconductor.org/packages/3.20/data/annotation bioc     4.4.3     3.20        \n## 5 BioCexp       https://bioconductor.org/packages/3.20/data/experiment bioc     4.4.3     3.20        \n## 6 BioCworkflows https://bioconductor.org/packages/3.20/workflows       bioc     4.4.3     3.20        \n## 7 BioCbooks     https://bioconductor.org/packages/3.20/books           bioc     4.4.3     3.20"
  }
]